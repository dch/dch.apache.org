<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter&nbsp;5.&nbsp;CouchDB API Server Database Methods</title><link href="html.css" type="text/css" rel="stylesheet"><meta content="DocBook XSL Stylesheets V1.76.1" name="generator"><link rel="home" href="index.html" title="CouchDB 1.1 Manual"><link rel="up" href="index.html" title="CouchDB 1.1 Manual"><link rel="prev" href="couchdb-api-basics.html" title="Chapter&nbsp;4.&nbsp;CouchDB API"><link rel="next" href="couchdb-api-dbdoc.html" title="Chapter&nbsp;6.&nbsp;CouchDB API Server Document Methods"><meta name="date" content="2012-04-17T23:46:58+00:00"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">Chapter&nbsp;5.&nbsp;CouchDB API Server Database Methods</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="couchdb-api-basics.html">Prev</a>&nbsp;</td><th align="center" width="60%">&nbsp;</th><td align="right" width="20%">&nbsp;<a accesskey="n" href="couchdb-api-dbdoc.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter&nbsp;5.&nbsp;CouchDB API Server Database Methods"><div class="titlepage"><div><div><h2 class="title"><a name="couchdb-api-db"></a>Chapter&nbsp;5.&nbsp;CouchDB API Server Database Methods</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db_get">5.1. <code class="literal">GET /db</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db_put">5.2. <code class="literal">PUT /db</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db_delete">5.3. <code class="literal">DELETE /db</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-changes_get">5.4. <code class="literal">GET /db/_changes</code></a></span></dt><dd><dl><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-changes_get-filters">5.4.1. Filtering</a></span></dt></dl></dd><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-compact_post">5.5. <code class="literal">POST /db/_compact</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-compact-design-doc_post">5.6. <code class="literal">POST /db/_compact/design-doc</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-view-cleanup_post">5.7. <code class="literal">POST /db/_view_cleanup</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-ensure-full-commit_post">5.8. <code class="literal">POST /db/_ensure_full_commit</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post">5.9. <code class="literal">POST /db/_bulk_docs</code></a></span></dt><dd><dl><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-insert">5.9.1. Inserting Documents in Bulk</a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-update">5.9.2. Updating Documents in Bulk</a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-commit">5.9.3. Bulk Documents Transaction Semantics</a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-errors">5.9.4. Bulk Document Validation and Conflict Errors</a></span></dt></dl></dd><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-temp-view_post">5.10. <code class="literal">POST /db/_temp_view</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-purge_post">5.11. <code class="literal">POST /db/_purge</code></a></span></dt><dd><dl><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-purge_post-indexrebuild">5.11.1. Updating Indexes</a></span></dt></dl></dd><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-all-docs_get">5.12. <code class="literal">GET /db/_all_docs</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-all-docs_post">5.13. <code class="literal">POST /db/_all_docs</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-missing-revs_post">5.14. <code class="literal">POST /db/_missing_revs</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-revs-diff_post">5.15. <code class="literal">POST /db/_revs_diff</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-security_get">5.16. <code class="literal">GET /db/_security</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-security_put">5.17. <code class="literal">PUT /db/_security</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-revs-limit_get">5.18. <code class="literal">GET /db/_revs_limit</code></a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-revs-limit_put">5.19. <code class="literal">PUT /db/_revs_limit</code></a></span></dt></dl></div><p>
    The Database methods provide an interface to an entire database
    withing CouchDB. These are database, rather than document, level
    requests.
  </p><p>
    A list of the available methods and URL paths are provided below:
  </p><div class="table"><a name="table-couchdb-api-db-summary"></a><p class="title"><b>Table&nbsp;5.1.&nbsp;Database API Calls</b></p><div class="table-contents"><table summary="Database API Calls" border="1"><colgroup><col class="method" width="33%"><col class="path" width="33%"><col class="desc" width="34%"></colgroup><thead><tr><th>Method</th><th>Path</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">GET</code></td><td><code class="literal">/db</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db_get" title="5.1.&nbsp;GET /db">
 Returns database information
 </a></td></tr><tr><td><code class="literal">PUT</code></td><td><code class="literal">/db</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db_put" title="5.2.&nbsp;PUT /db">
 Create a new database
 </a></td></tr><tr><td><code class="literal">DELETE</code></td><td><code class="literal">/db</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db_delete" title="5.3.&nbsp;DELETE /db">
 Delete an existing database
 </a></td></tr><tr><td><code class="literal">GET</code></td><td><code class="literal">/db/_all_docs</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-all-docs_get" title="5.12.&nbsp;GET /db/_all_docs">
 Returns a built-in view of all documents in this database
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_all_docs</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-all-docs_post" title="5.13.&nbsp;POST /db/_all_docs">
 Returns certain rows from the built-in view of all documents
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_bulk_docs</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post" title="5.9.&nbsp;POST /db/_bulk_docs">
 Insert multiple documents in to the database in a single request
 </a></td></tr><tr><td><code class="literal">GET</code></td><td><code class="literal">/db/_changes</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-changes_get" title="5.4.&nbsp;GET /db/_changes">
 Returns changes for the given database
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_compact</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-compact_post" title="5.5.&nbsp;POST /db/_compact">
 Starts a compaction for the database
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_compact/design-doc</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-compact-design-doc_post" title="5.6.&nbsp;POST /db/_compact/design-doc">
 Starts a compaction for all the views in the selected design
 document
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_ensure_full_commit</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-ensure-full-commit_post" title="5.8.&nbsp;POST /db/_ensure_full_commit">
 Makes sure all uncommitted changes are written and synchronized
 to the disk
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_missing_revs</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-missing-revs_post" title="5.14.&nbsp;POST /db/_missing_revs">
 Given a list of document revisions, returns the document
 revisions that do not exist in the database
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_purge</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-purge_post" title="5.11.&nbsp;POST /db/_purge">
 Purge some historical documents entirely from database history
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_revs_diff</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-revs-diff_post" title="5.15.&nbsp;POST /db/_revs_diff">
 Given a list of document revisions, returns differences between
 the given revisions and ones that are in the database
 </a></td></tr><tr><td><code class="literal">GET</code></td><td><code class="literal">/db/_revs_limit</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-revs-limit_get" title="5.18.&nbsp;GET /db/_revs_limit">
 Gets the limit of historical revisions to store for a single
 document in the database
 </a></td></tr><tr><td><code class="literal">PUT</code></td><td><code class="literal">/db/_revs_limit</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-revs-limit_put" title="5.19.&nbsp;PUT /db/_revs_limit">
 Sets the limit of historical revisions to store for a single
 document in the database
 </a></td></tr><tr><td><code class="literal">GET</code></td><td><code class="literal">/db/_security</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-security_get" title="5.16.&nbsp;GET /db/_security">
 Returns the special security object for the database
 </a></td></tr><tr><td><code class="literal">PUT</code></td><td><code class="literal">/db/_security</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-security_put" title="5.17.&nbsp;PUT /db/_security">
 Sets the special security object for the database
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_temp_view</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-temp-view_post" title="5.10.&nbsp;POST /db/_temp_view">
 Execute a given view function for all documents and return the
 result
 </a></td></tr><tr><td><code class="literal">POST</code></td><td><code class="literal">/db/_view_cleanup</code></td><td><a class="link" href="couchdb-api-db.html#couchdb-api-db_db-view-cleanup_post" title="5.7.&nbsp;POST /db/_view_cleanup">
 Removes view files that are not used by any design document
 </a></td></tr></tbody></table></div></div><br class="table-break"><p>
    For all the database methods, the database name within the URL path
    should be the database name that you wish to perform the operation
    on. For example, to obtain the meta information for the database
    <code class="literal">recipes</code>, you would use the HTTP request:
  </p><pre class="programlisting">GET /recipes</pre><p>
    For clarity, the form below is used in the URL paths:
  </p><pre class="programlisting">GET /db</pre><p>
    Where <code class="literal">db</code> is the name of any database.
  </p><div class="section" title="5.1.&nbsp;GET /db"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db_get"></a>5.1.&nbsp;<code class="literal">GET /db</code></h2></div></div></div><div class="informaltable"><table summary="URL API GET /db" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">GET /db</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 Information about the database in JSON format
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr><tr><td colspan="3"><span class="bold"><strong>Return Codes</strong></span></td></tr><tr><td>404</td><td colspan="2">
 The requested content could not be found. The returned content
 will include further information, as a JSON object, if available.
 </td></tr></tbody></table></div><p>
      Gets information about the specified database. For example, to
      retrieve the information for the database
      <code class="literal">recipe</code>:
    </p><div class="formalcodebox"><div class="formalcodebox-title">HTTP Request</div><pre class="programlisting">GET http://couchdb:5984/recipes
Accept: application/json</pre></div><p>
      The JSON response contains meta information about the database. A
      sample of the JSON returned for an empty database is provided
      below:
    </p><div class="formalcodebox"><div class="formalcodebox-title">HTTP Response</div><pre class="programlisting">{
   "compact_running" : false,
   "committed_update_seq" : 375048,
   "disk_format_version" : 5,
   "disk_size" : 33153123,
   "doc_count" : 18386,
   "doc_del_count" : 0,
   "db_name" : "recipes",
   "instance_start_time" : "1290700340925570",
   "purge_seq" : 10,
   "update_seq" : 375048
}</pre></div><p>
      The elements of the returned structure are shown in the table
      below:
    </p><div class="table"><a name="table-couchdb-api-db-json-db-info"></a><p class="title"><b>Table&nbsp;5.2.&nbsp;
 CouchDB database information object
 </b></p><div class="table-contents"><table summary="
 CouchDB database information object
 " border="1"><colgroup><col class="item" width="30%"><col class="desc" width="70%"></colgroup><tbody><tr><td><span class="bold"><strong>Field</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">committed_update_seq</code>  </td><td>
 The number of committed update.
 </td></tr><tr><td><code class="literal">compact_running</code>  </td><td>
 Set to true if the database compaction routine is operating on
 this database.
 </td></tr><tr><td><code class="literal">db_name</code>  </td><td>
 The name of the database.
 </td></tr><tr><td><code class="literal">disk_format_version</code>  </td><td>
 The version of the physical format used for the data when it is
 stored on disk.
 </td></tr><tr><td><code class="literal">disk_size</code>  </td><td>
 Size in bytes of the data as stored on the disk. Views indexes
 are not included in the calculation.
 </td></tr><tr><td><code class="literal">doc_count</code>  </td><td>
 A count of the documents in the specified database.
 </td></tr><tr><td><code class="literal">doc_del_count</code>  </td><td>
 Number of deleted documents
 </td></tr><tr><td><code class="literal">instance_start_time</code>  </td><td>
 Timestamp of when the database was created, expressed in
 milliseconds since the epoch.
 </td></tr><tr><td><code class="literal">purge_seq</code>  </td><td>
 The number of purge operations on the database.
 </td></tr><tr><td><code class="literal">update_seq</code>  </td><td>
 The current number of updates to the database.
 </td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="5.2.&nbsp;PUT /db"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db_put"></a>5.2.&nbsp;<code class="literal">PUT /db</code></h2></div></div></div><div class="informaltable"><table summary="URL API PUT /db" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">PUT /db</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON success statement
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr><tr><td colspan="3"><span class="bold"><strong>Return Codes</strong></span></td></tr><tr><td>400</td><td colspan="2">
 Invalid database name
 </td></tr><tr><td>412</td><td colspan="2">
 Database already exists
 </td></tr></tbody></table></div><p>
      Creates a new database. The database name must be composed of one
      or more of the following characters:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
          Lowercase characters (<code class="literal">a-z</code>)
        </p></li><li class="listitem"><p>
          Name must begin with a lowercase letter
        </p></li><li class="listitem"><p>
          Digits (<code class="literal">0-9</code>)
        </p></li><li class="listitem"><p>
          Any of the characters <code class="literal">_</code>,
          <code class="literal">$</code>, <code class="literal">(</code>,
          <code class="literal">)</code>, <code class="literal">+</code>,
          <code class="literal">-</code>, and <code class="literal">/</code>.
        </p></li></ul></div><p>
      Trying to create a database that does not meet these requirements
      will return an error quoting these restrictions.
    </p><p>
      To create the database <code class="literal">recipes</code>:
    </p><pre class="programlisting">PUT http://couchdb:5984/recipes
Content-Type: application/json</pre><p>
      The returned content contains the JSON status:
    </p><pre class="programlisting">{
   "ok" : true
}</pre><p>
      Anything should be treated as an error, and the problem should be
      taken form the HTTP response code.
    </p></div><div class="section" title="5.3.&nbsp;DELETE /db"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db_delete"></a>5.3.&nbsp;<code class="literal">DELETE /db</code></h2></div></div></div><div class="informaltable"><table summary="URL API DELETE /db" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">DELETE /db</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON success statement
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr><tr><td colspan="3"><span class="bold"><strong>Return Codes</strong></span></td></tr><tr><td>200</td><td colspan="2">
 Database has been deleted
 </td></tr><tr><td>404</td><td colspan="2">
 The requested content could not be found. The returned content
 will include further information, as a JSON object, if available.
 </td></tr></tbody></table></div><p>
      Deletes the specified database, and all the documents and
      attachments contained within it.
    </p><p>
      To delete the database <code class="literal">recipes</code> you would send
      the request:
    </p><pre class="programlisting">DELETE http://couchdb:5984/recipes
Content-Type: application/json</pre><p>
      If successful, the returned JSON will indicate success
    </p><pre class="programlisting">{
   "ok" : true
}</pre></div><div class="section" title="5.4.&nbsp;GET /db/_changes"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-changes_get"></a>5.4.&nbsp;<code class="literal">GET /db/_changes</code></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-changes_get-filters">5.4.1. Filtering</a></span></dt></dl></div><div class="informaltable"><table summary="URL API GET /db/_changes" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">GET /db/_changes</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON of the changes to the database
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr><tr><td><span class="bold"><strong>Query Arguments</strong></span></td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">doc_ids</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Specify the list of documents IDs to be filtered
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>json</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>none</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">feed</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Type of feed
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>string</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>normal</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Supported Values</strong></span></td><td class="auto-generated">&nbsp;</td></tr><tr><td>&nbsp;</td><td><code class="literal">continuous</code></td><td>Continuous (non-polling) mode</td></tr><tr><td>&nbsp;</td><td><code class="literal">longpoll</code></td><td>Long polling mode</td></tr><tr><td>&nbsp;</td><td><code class="literal">normal</code></td><td>Normal mode</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">filter</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Filter function from a design document to get updates
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>string</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>none</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Supported Values</strong></span></td><td class="auto-generated">&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">heartbeat</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Period after which an empty line is sent during longpoll or
 continuous
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>numeric</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>60000</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Quantity</strong></span></td><td>milliseconds</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">include_docs</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Include the document with the result
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>boolean</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>false</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">limit</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Maximum number of rows rows to return
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>numeric</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>none</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">since</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Start the results from changes immediately after the
 specified sequence number
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>numeric</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>0</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">timeout</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Maximum period to wait before the response is sent
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>numeric</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>60000</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Quantity</strong></span></td><td>milliseconds</td></tr></tbody></table></div><p>
      Obtains a list of the changes made to the database. This can be
      used to monitor for update and modifications to the database for
      post processing or synchronization. There are three different
      types of supported changes feeds, poll, longpoll, and continuous.
      All requests are poll requests by default. You can select any feed
      type explicitly using the <code class="literal">feed</code> query argument.
    </p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
            <span class="bold"><strong>Poll</strong></span>
          </p><p>
            With polling you can request the changes that have occured
            since a specific sequence number. This returns the JSON
            structure containing the changed document information. When
            you perform a poll change request, only the changes since
            the specific sequence number are returned. For example, the
            query
          </p><pre class="programlisting">DELETE http://couchdb:5984/recipes/_changes
Content-Type: application/json</pre><p>
            Will get all of the changes in the database. You can request
            a starting point using the <code class="literal">since</code> query
            argument and specifying the sequence number. You will need
            to record the latest sequence number in your client and then
            use this when making another request as the new value to the
            <code class="literal">since</code> parameter.
          </p></li><li class="listitem"><p>
            <span class="bold"><strong>Longpoll</strong></span>
          </p><p>
            With long polling the request to the server will remain open
            until a change is made on the database, when the changes
            will be reported, and then the connection will close. The
            long poll is useful when you want to monitor for changes for
            a specific purpose without wanting to monitoring
            continuously for changes.
          </p><p>
            Because the wait for a change can be significant you can set
            a timeout before the connection is automatically closed (the
            <code class="literal">timeout</code> argument). You can also set a
            heartbeat interval (using the <code class="literal">heartbeat</code>
            query argument), which sends a newline to keep the
            connection open.
          </p></li><li class="listitem"><p>
            <span class="bold"><strong>Continuous</strong></span>
          </p><p>
            Continuous sends all new changes back to the client
            immediately, without closing the connection. In continuous
            mode the format of the changes is slightly different to
            accommodate the continuous nature while ensuring that the
            JSON output is still valid for each change notification.
          </p><p>
            As with the longpoll feed type you can set both the timeout
            and heartbeat intervals to ensure that the connection is
            kept open for new changesand updates.
          </p></li></ul></div><p>
    </p><p>
      The return structure for <code class="literal">normal</code> and
      <code class="literal">longpoll</code> modes is a JSON array of changes
      objects, and the last update sequence number. The structure is
      described in the following table.
    </p><div class="table"><a name="table-couchdb-api-db_db-json-changes"></a><p class="title"><b>Table&nbsp;5.3.&nbsp;
 Changes information for a database
 </b></p><div class="table-contents"><table summary="
 Changes information for a database
 " border="1"><colgroup><col class="item" width="30%"><col class="desc" width="70%"></colgroup><tbody><tr><td><span class="bold"><strong>Field</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">last_seq</code>  </td><td>
 Last change sequence number
 </td></tr><tr><td><code class="literal">results</code> <code class="literal">[array]</code> </td><td>
 Changes made to a database
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">changes</code> <code class="literal">[array]</code> </td><td>
 List of changes, field-by-field, for this document
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">id</code>  </td><td>
 Document ID
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">seq</code>  </td><td>
 Update sequence number
 </td></tr></tbody></table></div></div><br class="table-break"><p>
      The return format for <code class="literal">continuous</code> mode the
      server sends a CRLF (carriage-return, linefeed) delimited line for
      each change. Each line contains the
      <a class="link" href="couchdb-api-db.html#table-couchdb-api-db_db-json-changes" title="Table&nbsp;5.3.&nbsp; Changes information for a database">JSON
      object</a>.
    </p><p>
      You can also request the full contents of each document change
      (instead of just the change notification) by using the
      <code class="literal">include_docs</code> parameter.
    </p><div class="section" title="5.4.1.&nbsp;Filtering"><div class="titlepage"><div><div><h3 class="title"><a name="couchdb-api-db_db-changes_get-filters"></a>5.4.1.&nbsp;Filtering</h3></div></div></div><p>
        You can filter the contents of the changes feed in a number of
        ways. The most basic way is to specify one or more document IDs
        to the query. This causes the returned structure value to only
        contain changes for the specified IDs. Note that the value of
        this query argument should be a JSON formatted array.
      </p><p>
        You can also filter the <code class="literal">_changes</code> feed by
        defining a filter function within a design document. The
        specification for the filter is the same as for replication
        filters. You specify the name of the filter function to the
        <code class="literal">filter</code> parameter, specifying the design
        document name and filter name. For example:
      </p><pre class="programlisting">GET /db/_changes?filter=design_doc/filtername</pre><p>
        The <code class="literal">_changes</code> feed can be used to watch
        changes to specific document ID's or the list of
        <code class="literal">_design</code> documents in a database. If the
        <code class="literal">filters</code> parameter is set to
        <code class="literal">_doc_ids</code> a list of doc IDs can be passed in
        the <code class="option">doc_ids</code> parameter as a JSON array.
      </p><p>
        For more information, see
        <a class="xref" href="">???</a>.
      </p></div></div><div class="section" title="5.5.&nbsp;POST /db/_compact"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-compact_post"></a>5.5.&nbsp;<code class="literal">POST /db/_compact</code></h2></div></div></div><div class="informaltable"><table summary="URL API POST /db/_compact" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_compact</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON success statement
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr><tr><td colspan="3"><span class="bold"><strong>Return Codes</strong></span></td></tr><tr><td>202</td><td colspan="2">
 Compaction request has been accepted
 </td></tr><tr><td>404</td><td colspan="2">
 The requested content could not be found. The returned content
 will include further information, as a JSON object, if available.
 </td></tr></tbody></table></div><p>
      Request compaction of the specified database. Compaction
      compresses the disk database file by performing the following
      operations:
    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
          Writes a new version of the database file, removing any unused
          sections from the new version during write. Because a new file
          is temporary created for this purpose, you will need twice the
          current storage space of the specified database in order for
          the compaction routine to complete.
        </p></li><li class="listitem"><p>
          Removes old revisions of documents from the database, up to
          the per-database limit specified by the
          <code class="literal">_revs_limit</code> database parameter. See
          <a class="xref" href="couchdb-api-db.html#couchdb-api-db_db_get" title="5.1.&nbsp;GET /db">Section&nbsp;5.1, &ldquo;<code class="literal">GET /db</code>&rdquo;</a> .
        </p></li></ul></div><p>
      Compaction can only be requested on an individual database; you
      cannot compact all the databases for a CouchDB instance. The
      compaction process runs as a background process.
    </p><p>
      You can determine if the compaction process is operating on a
      database by obtaining the database meta information, the
      <code class="literal">compact_running</code> value of the returned database
      structure will be set to true. See
      <a class="xref" href="couchdb-api-db.html#couchdb-api-db_db_get" title="5.1.&nbsp;GET /db">Section&nbsp;5.1, &ldquo;<code class="literal">GET /db</code>&rdquo;</a> .
    </p><p>
      You can also obtain a list of running processes to determine
      whether compaction is currently running. See
      <a class="xref" href="couchdb-api-misc.html#couchdb-api-misc_active-tasks_get" title="9.2.&nbsp;GET /_active_tasks">Section&nbsp;9.2, &ldquo;<code class="literal">GET /_active_tasks</code>&rdquo;</a>.
    </p></div><div class="section" title="5.6.&nbsp;POST /db/_compact/design-doc"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-compact-design-doc_post"></a>5.6.&nbsp;<code class="literal">POST /db/_compact/design-doc</code></h2></div></div></div><div class="informaltable"><table summary="URL API POST /db/_compact/design-doc" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_compact/design-doc</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON success statement
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">yes</td></tr><tr><td colspan="3"><span class="bold"><strong>Return Codes</strong></span></td></tr><tr><td>202</td><td colspan="2">
 Compaction request has been accepted
 </td></tr><tr><td>404</td><td colspan="2">
 The requested content could not be found. The returned content
 will include further information, as a JSON object, if available.
 </td></tr></tbody></table></div><p>
      Compacts the view indexes associated with the specified design
      document. You can use this in place of the full database
      compaction if you know a specific set of view indexes have been
      affected by a recent database change.
    </p><p>
      For example, to compact the views associated with the
      <code class="literal">recipes</code> design document:
    </p><pre class="programlisting">POST http://couchdb:5984/recipes/_compact/recipes
Content-Type: application/json</pre><p>
      CouchDB will immediately return with a status indicating that the
      compaction request has been received (HTTP status code 202):
    </p><pre class="programlisting">{
   "ok" : true
}</pre></div><div class="section" title="5.7.&nbsp;POST /db/_view_cleanup"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-view-cleanup_post"></a>5.7.&nbsp;<code class="literal">POST /db/_view_cleanup</code></h2></div></div></div><div class="informaltable"><table summary="URL API POST /db/_view_cleanup" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_view_cleanup</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON success statement
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">yes</td></tr></tbody></table></div><p>
      Cleans up the cached view output on disk for a given view. For
      example:
    </p><pre class="programlisting">POST http://couchdb:5984/recipes/_view_cleanup
Content-Type: application/json</pre><p>
      If the request is successful, a basic status message us returned:
    </p><pre class="programlisting">{
   "ok" : true
}</pre></div><div class="section" title="5.8.&nbsp;POST /db/_ensure_full_commit"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-ensure-full-commit_post"></a>5.8.&nbsp;<code class="literal">POST /db/_ensure_full_commit</code></h2></div></div></div><div class="informaltable"><table summary="URL API POST /db/_ensure_full_commit" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_ensure_full_commit</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON success statement
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr><tr><td colspan="3"><span class="bold"><strong>Return Codes</strong></span></td></tr><tr><td>200</td><td colspan="2">
 Commit completed successfully
 </td></tr><tr><td>404</td><td colspan="2">
 The requested content could not be found. The returned content
 will include further information, as a JSON object, if available.
 </td></tr></tbody></table></div><p>
      Commits any recent changes to the specified database to disk. You
      should call this if you want to ensure that recent changes have
      been written. For example, to commit all the changes to disk for
      the database <code class="literal">recipes</code> you would use:
    </p><pre class="programlisting">POST http://couchdb:5984/recipes/_ensure_full_commit
Content-Type: application/json</pre><p>
      This returns a status message, containing the success message and
      the timestamp for when the CouchDB instance was started:
    </p><pre class="programlisting">{
  "ok" : true,
  "instance_start_time" : "1288186189373361"
}</pre></div><div class="section" title="5.9.&nbsp;POST /db/_bulk_docs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-bulk-docs_post"></a>5.9.&nbsp;<code class="literal">POST /db/_bulk_docs</code></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-insert">5.9.1. Inserting Documents in Bulk</a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-update">5.9.2. Updating Documents in Bulk</a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-commit">5.9.3. Bulk Documents Transaction Semantics</a></span></dt><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-errors">5.9.4. Bulk Document Validation and Conflict Errors</a></span></dt></dl></div><div class="informaltable"><table summary="URL API POST /db/_bulk_docs" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_bulk_docs</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 JSON of the docs and updates to be applied
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON of updated documents
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr><tr><td colspan="3"><span class="bold"><strong>Return Codes</strong></span></td></tr><tr><td>201</td><td colspan="2">
 Document(s) have been created or updated
 </td></tr></tbody></table></div><p>
      The bulk document API allows you to create and update multiple
      documents at the same time within a single request. The basic
      operation is similar to creating or updating a single document,
      except that you batch the document structure and information and .
      When creating new documents the document ID is optional. For
      updating existing documents, you must provide the document ID,
      revision information, and new document values.
    </p><p>
      For both inserts and updates the basic structure of the JSON is
      the same:
    </p><div class="table"><a name="table-couchdb-api-db_db-bulk-docs-json"></a><p class="title"><b>Table&nbsp;5.4.&nbsp;
 Bulk Documents
 </b></p><div class="table-contents"><table summary="
 Bulk Documents
 " border="1"><colgroup><col class="item" width="30%"><col class="desc" width="70%"></colgroup><tbody><tr><td><span class="bold"><strong>Field</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">all_or_nothing</code> (optional) </td><td>
 Sets the database commit mode to use all-or-nothing semantics
 </td></tr><tr><td><code class="literal">docs</code> <code class="literal">[array]</code> </td><td>
 Bulk Documents Document
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">_id</code> (optional) </td><td>
 Document ID
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">_rev</code> (optional) </td><td>
 Revision ID (when updating an existing document)
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">_deleted</code> (optional) </td><td>
 Whether the document should be deleted
 </td></tr></tbody></table></div></div><br class="table-break"><div class="section" title="5.9.1.&nbsp;Inserting Documents in Bulk"><div class="titlepage"><div><div><h3 class="title"><a name="couchdb-api-db_db-bulk-docs_post-insert"></a>5.9.1.&nbsp;Inserting Documents in Bulk</h3></div></div></div><p>
        To insert documents in bulk into a database you need to supply a
        JSON structure with the array of documents that you want to add
        to the database. Using this method you can either include a
        document ID, or allow the document ID to be automatically
        generated.
      </p><p>
        For example, the following inserts three new documents, two with
        the supplied document IDs, and one which will have a document ID
        generated:
      </p><pre class="programlisting">{
   "docs" : [
      {
         "_id" : "FishStew",
         "servings" : 4,
         "subtitle" : "Delicious with fresh bread",
         "title" : "Fish Stew"
      },
      {
         "_id" : "LambStew",
         "servings" : 6,
         "subtitle" : "Delicious with scone topping",
         "title" : "Lamb Stew"
      },
      {
         "servings" : 8,
         "subtitle" : "Delicious with suet dumplings",
         "title" : "Beef Stew"
      },
   ]
}</pre><p>
        The return type from a bulk insertion will be 201, with the
        content of the returned structure indicating specific success or
        otherwise messages on a per-document basis.
      </p><p>
        The return structure from the example above contains a list of
        the documents created, here with the combination and their
        revision IDs:
      </p><pre class="programlisting">POST http://couchdb:5984/recipes/_bulk_docs
Content-Type: application/json

[
   {
      "id" : "FishStew",
      "rev" : "1-9c65296036141e575d32ba9c034dd3ee",
   },
   {
      "id" : "LambStew",
      "rev" : "1-34c318924a8f327223eed702ddfdc66d",
   },
   {
      "id" : "7f7638c86173eb440b8890839ff35433",
      "rev" : "1-857c7cbeb6c8dd1dd34a0c73e8da3c44",
   }
]</pre><p>
        The content and structure of the returned JSON will depend on
        the transaction semantics being used for the bulk update; see
        <a class="xref" href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-commit" title="5.9.3.&nbsp;Bulk Documents Transaction Semantics">Section&nbsp;5.9.3, &ldquo;Bulk Documents Transaction Semantics&rdquo;</a>
        for more information. Conflicts and validation errors when
        updating documents in bulk must be handled separately; see
        <a class="xref" href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-errors" title="5.9.4.&nbsp;Bulk Document Validation and Conflict Errors">Section&nbsp;5.9.4, &ldquo;Bulk Document Validation and Conflict Errors&rdquo;</a>.
      </p></div><div class="section" title="5.9.2.&nbsp;Updating Documents in Bulk"><div class="titlepage"><div><div><h3 class="title"><a name="couchdb-api-db_db-bulk-docs_post-update"></a>5.9.2.&nbsp;Updating Documents in Bulk</h3></div></div></div><p>
        The bulk document update procedure is similar to the insertion
        procedure, except that you must specify the document ID and
        current revision for every document in the bulk update JSON
        string.
      </p><p>
        For example, you could send the following request:
      </p><pre class="programlisting">POST http://couchdb:5984/recipes/_bulk_docs
Content-Type: application/json

{
   "docs" : [
      {
         "_id" : "FishStew",
         "_rev" : "1-9c65296036141e575d32ba9c034dd3ee",
         "servings" : 4,
         "subtitle" : "Delicious with freshly baked bread",
         "title" : "Fish Stew"
      },
      {
         "_id" : "LambStew",
         "_rev" : "1-34c318924a8f327223eed702ddfdc66d",
         "servings" : 6,
         "subtitle" : "Serve with a wholemeal scone topping",
         "title" : "Lamb Stew"
      },
      {
         "_id" : "7f7638c86173eb440b8890839ff35433"
         "_rev" : "1-857c7cbeb6c8dd1dd34a0c73e8da3c44",
         "servings" : 8,
         "subtitle" : "Hand-made dumplings make a great accompaniment",
         "title" : "Beef Stew"
      }
   ]
}</pre><p>
        The return structure is the JSON of the updated documents, with
        the new revision and ID information:
      </p><pre class="programlisting">[
   {
      "id" : "FishStew",
      "rev" : "2-e7af4c4e9981d960ecf78605d79b06d1"
   },
   {
      "id" : "LambStew",
      "rev" : "2-0786321986194c92dd3b57dfbfc741ce"
   },
   {
      "id" : "7f7638c86173eb440b8890839ff35433",
      "rev" : "2-bdd3bf3563bee516b96885a66c743f8e"
   }
]</pre><p>
        You can optionally delete documents during a bulk update by
        adding the <code class="literal">_deleted</code> field with a value of
        <code class="literal">true</code> to each docment ID/revision combination
        within the submitted JSON structure.
      </p><p>
        The return type from a bulk insertion will be 201, with the
        content of the returned structure indicating specific success or
        otherwise messages on a per-document basis.
      </p><p>
        The content and structure of the returned JSON will depend on
        the transaction semantics being used for the bulk update; see
        <a class="xref" href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-commit" title="5.9.3.&nbsp;Bulk Documents Transaction Semantics">Section&nbsp;5.9.3, &ldquo;Bulk Documents Transaction Semantics&rdquo;</a>
        for more information. Conflicts and validation errors when
        updating documents in bulk must be handled separately; see
        <a class="xref" href="couchdb-api-db.html#couchdb-api-db_db-bulk-docs_post-errors" title="5.9.4.&nbsp;Bulk Document Validation and Conflict Errors">Section&nbsp;5.9.4, &ldquo;Bulk Document Validation and Conflict Errors&rdquo;</a>.
      </p></div><div class="section" title="5.9.3.&nbsp;Bulk Documents Transaction Semantics"><div class="titlepage"><div><div><h3 class="title"><a name="couchdb-api-db_db-bulk-docs_post-commit"></a>5.9.3.&nbsp;Bulk Documents Transaction Semantics</h3></div></div></div><p>
        CouchDB supports two different modes for updating (or inserting)
        documents using the bulk documentation system. Each mode affects
        both the state of the documents in the event of system failure,
        and the level of conflict checking performed on each document.
        The two modes are:
      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
            <code class="literal">non-atomic</code>
          </p><p>
            The default mode is non-atomic, that is, CouchDB will only
            guarantee that some of the documents will be saved when you
            send the request. The response will contain the list of
            documents successfully inserted or updated during the
            process. In the event of a crash, some of the documents may
            have been successfully saved, and some will have been lost.
          </p><p>
            In this mode, the response structure will indicate whether
            the document was updated by supplying the new
            <code class="literal">_rev</code> parameter indicating a new document
            revision was created. If the update failed, then you will
            get an <code class="literal">error</code> of type
            <code class="literal">conflict</code>. For example:
          </p><pre class="programlisting">[
   {
      "id" : "FishStew",
      "error" : "conflict",
      "reason" : "Document update conflict."
   },
   {
      "id" : "LambStew",
      "error" : "conflict",
      "reason" : "Document update conflict."
   },
   {
      "id" : "7f7638c86173eb440b8890839ff35433",
      "error" : "conflict",
      "reason" : "Document update conflict."
   }
]</pre><p>
            In this case no new revision has been created and you will
            need to submit the document update, with the correct
            revision tag, to update the document.
          </p></li><li class="listitem"><p>
            <code class="literal">all-or-nothing</code>
          </p><p>
            In all-or-nothing mode, either all documents are written to
            the database, or no documents are written to the database,
            in the event of a system failure during commit.
          </p><p>
            In addition, the per-document conflict checking is not
            performed. Instead a new revision of the document is
            created, even if the new revision is in conflict with the
            current revision in the database. The returned structure
            contains the list of documents with new revisions:
          </p><pre class="programlisting">[
   {
      "id" : "FishStew",
      "rev" : "2-e7af4c4e9981d960ecf78605d79b06d1"
   },
   {
      "id" : "LambStew",
      "rev" : "2-0786321986194c92dd3b57dfbfc741ce"
   },
   {
      "id" : "7f7638c86173eb440b8890839ff35433",
      "rev" : "2-bdd3bf3563bee516b96885a66c743f8e"
   }
]</pre><p>
            When updating documents using this mode the revision of a
            document included in views will be arbitrary. You can check
            the conflict status for a document by using the
            <code class="literal">conflicts=true</code> query argument when
            accessing the view. Conflicts should be handled individually
            to ensure the consistency of your database.
          </p><p>
            To use this mode, you must include the
            <code class="literal">all_or_nothing</code> field (set to true) within
            the main body of the JSON of the request.
          </p></li></ul></div><p>
        The effects of different database operations on the different
        modes are summarized in the table below:
      </p><div class="table"><a name="table-couchdb-api-db_db-bulk-docs_post-commit"></a><p class="title"><b>Table&nbsp;5.5.&nbsp;Conflicts on Bulk Inserts</b></p><div class="table-contents"><table summary="Conflicts on Bulk Inserts" border="1"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><thead><tr><th>
                Transaction Mode
              </th><th>
                Transaction
              </th><th>
                Cause
              </th><th>
                Resolution
              </th></tr></thead><tbody><tr><td>
                Non-atomic
              </td><td>
                Insert
              </td><td>
                Requested document ID already exists
              </td><td>
                Resubmit with different document ID, or update the
                existing document
              </td></tr><tr><td>
                Non-atomic
              </td><td>
                Update
              </td><td>
                Revision missing or incorrect
              </td><td>
                Resubmit with correct revision
              </td></tr><tr><td>
                All-or-nothing
              </td><td>
                Insert
              </td><td>
                Additional revision inserted
              </td><td>
                Resolve conflicted revisions
              </td></tr><tr><td>
                All-or-nothing
              </td><td>
                Update
              </td><td>
                Additional revision inserted
              </td><td>
                Resolve conflicted revisions
              </td></tr></tbody></table></div></div><br class="table-break"><p>
        Replication of documents is independent of the type of insert or
        update. The documents and revisions created during a bulk insert
        or update are replicated in the same way as any other document.
        This can mean that if you make use of the all-or-nothing mode
        the exact list of documents, revisions (and their conflict
        state) may or may not be replicated to other databases
        correctly.
      </p></div><div class="section" title="5.9.4.&nbsp;Bulk Document Validation and Conflict Errors"><div class="titlepage"><div><div><h3 class="title"><a name="couchdb-api-db_db-bulk-docs_post-errors"></a>5.9.4.&nbsp;Bulk Document Validation and Conflict Errors</h3></div></div></div><p>
        The JSON returned by the <code class="literal">_bulk_docs</code> operation
        consists of an array of JSON structures, one for each document
        in the original submission. The returned JSON structure should
        be examined to ensure that all of the documents submitted in the
        original request were successfully added to the database.
      </p><p>
        The exact structure of the returned information is shown in
        <a class="xref" href="couchdb-api-db.html#table-couchdb-api-db_db-bulk-docs-return-json" title="Table&nbsp;5.6.&nbsp; Bulk Document Response">Table&nbsp;5.6, &ldquo;
 Bulk Document Response
 &rdquo;</a>.
      </p><div class="table"><a name="table-couchdb-api-db_db-bulk-docs-return-json"></a><p class="title"><b>Table&nbsp;5.6.&nbsp;
 Bulk Document Response
 </b></p><div class="table-contents"><table summary="
 Bulk Document Response
 " border="1"><colgroup><col class="item" width="30%"><col class="desc" width="70%"></colgroup><tbody><tr><td><span class="bold"><strong>Field</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">docs</code> <code class="literal">[array]</code> </td><td>
 Bulk Docs Returned Documents
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">error</code>  </td><td>
 Error type
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">id</code>  </td><td>
 Document ID
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">reason</code>  </td><td>
 Error string with extended reason
 </td></tr></tbody></table></div></div><br class="table-break"><p>
        When a document (or document revision) is not correctly comitted
        to the database because of an error, you should check the
        <code class="literal">error</code> field to determine error type and
        course of action. Errors will be one of the following type:
      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
            <code class="literal">conflict</code>
          </p><p>
            The document as submitted is in conflict. If you used the
            default bulk transaction mode then the new revision will not
            have been created and you will need to re-submit the
            document to the database. If you used
            <code class="literal">all-or-nothing</code> mode then you will need to
            manually resolve the conflicted revisions of the document.
          </p><p>
            Conflict resolution of documents added using the bulk docs
            interface is identical to the resolution procedures used
            when resolving conflict errors during replication.
          </p></li><li class="listitem"><p>
            <code class="literal">forbidden</code>
          </p><p>
            Entries with this error type indicate that the validation
            routine applied to the document during submission has
            returned an error.
          </p><p>
            For example, if your validation routine includes the
            following:
          </p><pre class="programlisting">throw({forbidden: 'invalid recipe ingredient'});</pre><p>
            The error returned will be:
          </p><pre class="programlisting">{
   "id" : "7f7638c86173eb440b8890839ff35433",
   "error" : "forbidden",
   "reason" : "invalid recipe ingredient"
}</pre><p>
            For more information, see
            <a class="xref" href="">???</a>.
          </p></li></ul></div></div></div><div class="section" title="5.10.&nbsp;POST /db/_temp_view"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-temp-view_post"></a>5.10.&nbsp;<code class="literal">POST /db/_temp_view</code></h2></div></div></div><div class="informaltable"><table summary="URL API POST /db/_temp_view" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_temp_view</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 JSON with the temporary view definition
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 Temporary view result set
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">yes</td></tr></tbody></table></div><p>
      Creates (and executes) a temporary view based on the view function
      supplied in the JSON request. For example:
    </p><pre class="programlisting">POST http://couchdb:5984/recipes/_temp_view
Content-Type: application/json

{
   "map" : "function(doc) { if (doc.value &gt; 9995) { emit(null, doc.value); } }"
}</pre><p>
      The resulting JSON response is the result from the execution of
      the temporary view:
    </p><pre class="programlisting">{
   "total_rows" : 3,
   "rows" : [
      {
         "value" : 9998.41913029012,
         "id" : "05361cc6aa42033878acc1bacb1f39c2",
         "key" : null
      },
      {
         "value" : 9998.94149934853,
         "id" : "1f443f471e5929dd7b252417625ed170",
         "key" : null
      },
      {
         "value" : 9998.01511339154,
         "id" : "1f443f471e5929dd7b252417629c102b",
         "key" : null
      }
   ],
   "offset" : 0
}</pre><p>
      The arguments also available to standard view requests also apply
      to temporary views, but the execution of the view may take some
      time as it relies on being executed at the time of the request. In
      addition to the time taken, they are also computationally very
      expensive to produce. You should use a defined view if you want to
      achieve the best performance.
    </p><p>
      For more information, see
      <a class="xref" href="">???</a>.
    </p></div><div class="section" title="5.11.&nbsp;POST /db/_purge"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-purge_post"></a>5.11.&nbsp;<code class="literal">POST /db/_purge</code></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="couchdb-api-db.html#couchdb-api-db_db-purge_post-indexrebuild">5.11.1. Updating Indexes</a></span></dt></dl></div><div class="informaltable"><table summary="URL API POST /db/_purge" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_purge</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 JSON of the document IDs/revisions to be purged
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON structure with purged documents and purge sequence
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr></tbody></table></div><p>
      A database purge permanently removes the references to deleted
      documents from the database. Deleting a document within CouchDB
      does not actually remove the documen from the database, instead,
      the document is marked as a deleted (and a new revision is
      created). This is to ensure that deleted documents are replicated
      to other databases as having been deleted. This also means that
      you can check the status of a document and identify that the
      document has been deleted.
    </p><p>
      The purge operation removes the refernces to the deleted documents
      from the database. The purging of old documents is not replicated
      to other databases. If you are replicating between databases and
      have deleted a large number of documents you should run purge on
      each database.
    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        Purging documents does not remove the space used by them on
        disk. To reclaim disk space, you should run a database compact
        (see <a class="xref" href="couchdb-api-db.html#couchdb-api-db_db-compact_post" title="5.5.&nbsp;POST /db/_compact">Section&nbsp;5.5, &ldquo;<code class="literal">POST /db/_compact</code>&rdquo;</a>, and
        compact views (see
        <a class="xref" href="couchdb-api-db.html#couchdb-api-db_db-compact-design-doc_post" title="5.6.&nbsp;POST /db/_compact/design-doc">Section&nbsp;5.6, &ldquo;<code class="literal">POST /db/_compact/design-doc</code>&rdquo;</a>).
      </p></div><p>
      To perform a purge operation you must send a request including the
      JSON of the document IDs that you want to purge. For example:
    </p><pre class="programlisting">POST http://couchdb:5984/recipes/_purge
Content-Type: application/json

{
  "FishStew" : [
    "17-b3eb5ac6fbaef4428d712e66483dcb79"
    ]
}</pre><p>
      The format of the request must include the document ID and one or
      more revisions that must be purged.
    </p><p>
      The response will contain the purge sequence number, and a list of
      the document IDs and revisions successfully purged.
    </p><pre class="programlisting">{
   "purged" : {
      "FishStew" : [
         "17-b3eb5ac6fbaef4428d712e66483dcb79"
      ]
   },
   "purge_seq" : 11
}</pre><div class="section" title="5.11.1.&nbsp;Updating Indexes"><div class="titlepage"><div><div><h3 class="title"><a name="couchdb-api-db_db-purge_post-indexrebuild"></a>5.11.1.&nbsp;Updating Indexes</h3></div></div></div><p>
        The number of purges on a database is tracked using a purge
        sequence. This is used by the view indexer to optimize the
        updating of views that contain the purged documents.
      </p><p>
        When the indexer identifies that the purge sequence on a
        database has changed, it compares the purge sequence of the
        database with that stored in the view index. If the difference
        between the stored sequence and database is sequence is only 1,
        then the indexer uses a cached list of the most recently purged
        documents, and then removes these documents from the index
        individually. This prevents completely rebuilding the index from
        scratch.
      </p><p>
        If the difference between the stored sequence number and current
        database sequence is greater than 1, then the view index is
        entirely rebuilt. This is an expensive operation as every
        document in the database must be examined.
      </p></div></div><div class="section" title="5.12.&nbsp;GET /db/_all_docs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-all-docs_get"></a>5.12.&nbsp;<code class="literal">GET /db/_all_docs</code></h2></div></div></div><div class="informaltable"><table summary="URL API GET /db/_all_docs" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">GET /db/_all_docs</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON object containing document information, ordered by the
 document ID
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr><tr><td><span class="bold"><strong>Query Arguments</strong></span></td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">descending</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Return the documents in descending by key order
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>boolean</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>false</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">endkey</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Stop returning records when the specified key is reached
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>string</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">endkey_docid</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Stop returning records when the specified document ID is
 reached
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>string</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">group</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Group the results using the reduce function to a group or
 single row
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>boolean</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>false</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">group_level</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Specify the group level to be used
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>numeric</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">include_docs</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Include the full content of the documents in the return
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>boolean</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>false</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">inclusive_end</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Specifies whether the specified end key should be included
 in the result
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>boolean</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>true</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">key</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Return only documents that match the specified key
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>string</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">limit</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Limit the number of the returned documents to the specified
 number
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>numeric</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">reduce</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Use the reduction function
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>boolean</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>true</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">skip</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Skip this number of records before starting to return the
 results
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>numeric</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>0</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">stale</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Allow the results from a stale view to be used
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>string</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Supported Values</strong></span></td><td class="auto-generated">&nbsp;</td></tr><tr><td>&nbsp;</td><td><code class="literal">ok</code></td><td>Allow stale views</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">startkey</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Return records starting with the specified key
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>string</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">startkey_docid</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Return records starting with the specified document ID
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>string</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Argument</strong></span></td><td><code class="literal">update_seq</code></td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Description</strong></span></td><td>
 Include the update sequence in the generated results
 </td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Optional</strong></span></td><td>yes</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Type</strong></span></td><td>boolean</td></tr><tr><td>&nbsp;</td><td><span class="bold"><strong>Default</strong></span></td><td>false</td></tr></tbody></table></div><p>
      Returns a JSON structure of all of the documents in a given
      database. The information is returned as a JSON structure
      containing meta information about the return structure, and the
      list documents and basic contents, consisting the ID, revision and
      key. The key is generated from the document ID.
    </p><div class="table"><a name="table-couchdb-api-db_db-all-docs"></a><p class="title"><b>Table&nbsp;5.7.&nbsp;
 All Database Documents
 </b></p><div class="table-contents"><table summary="
 All Database Documents
 " border="1"><colgroup><col class="item" width="30%"><col class="desc" width="70%"></colgroup><tbody><tr><td><span class="bold"><strong>Field</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">offset</code>  </td><td>
 Offset where the document list started
 </td></tr><tr><td><code class="literal">rows</code> <code class="literal">[array]</code> </td><td>
 Array of document object
 </td></tr><tr><td><code class="literal">total_rows</code>  </td><td>
 Number of documents in the database/view
 </td></tr><tr><td><code class="literal">update_seq</code> (optional) </td><td>
 Current update sequence for the database
 </td></tr></tbody></table></div></div><br class="table-break"><p>
      By default the information returned contains only the document ID
      and revision. For example, the request:
    </p><div class="formalcodebox"><div class="formalcodebox-title">HTTP Request</div><pre class="programlisting">GET http://couchdb:5984/recipes/_all_docs
Accept: application/json</pre></div><p>
      Returns the following structure:
    </p><div class="formalcodebox"><div class="formalcodebox-title">HTTP Response</div><pre class="programlisting">{
   "total_rows" : 18386,
   "rows" : [
      {
         "value" : {
            "rev" : "1-bc0d5aed1e339b1cc1f29578f3220a45"
         },
         "id" : "Aberffrawcake",
         "key" : "Aberffrawcake"
      },
      {
         "value" : {
            "rev" : "3-68a20c89a5e70357c20148f8e82ca331"
         },
         "id" : "Adukiandorangecasserole-microwave",
         "key" : "Adukiandorangecasserole-microwave"
      },
      {
         "value" : {
            "rev" : "3-9b2851ed9b6f655cc4eb087808406c60"
         },
         "id" : "Aioli-garlicmayonnaise",
         "key" : "Aioli-garlicmayonnaise"
      },
      ...
         ],
   "offset" : 0
}</pre></div><p>
      The information is returned in the form of a temporary view of all
      the database documents, with the returned key consisting of the ID
      of the document. The remainder of the interface is therefore
      identical to the View query arguments and their behavior.
    </p></div><div class="section" title="5.13.&nbsp;POST /db/_all_docs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-all-docs_post"></a>5.13.&nbsp;<code class="literal">POST /db/_all_docs</code></h2></div></div></div><div class="informaltable"><table summary="URL API POST /db/_all_docs" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_all_docs</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 JSON of the document IDs you want included
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON of the returned view
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr></tbody></table></div><p>
      The <code class="literal">POST</code> to <code class="literal">_all_docs</code> allows
      to specify multiple keys to be selected from the database. This
      enables you to request multiple documents in a single request, in
      place of multiple
      <a class="xref" href="couchdb-api-dbdoc.html#couchdb-api-dbdoc_db-doc_get" title="6.2.&nbsp;GET /db/doc">Section&nbsp;6.2, &ldquo;<code class="literal">GET /db/doc</code>&rdquo;</a> requests.
    </p><p>
      The request body should contain a list of the keys to be returned
      as an array to a <code class="literal">keys</code> object. For example:
    </p><div class="formalcodebox"><div class="formalcodebox-title">HTTP Request</div><pre class="programlisting">POST http://couchdb:5984/recipes/_all_docs
User-Agent: MyApp/0.1 libwww-perl/5.837

{
   "keys" : [
      "Zingylemontart",
      "Yogurtraita"
   ]
}</pre></div><p>
      The return JSON is the all documents structure, but with only the
      selected keys in the output:
    </p><div class="formalcodebox"><div class="formalcodebox-title">HTTP Response</div><pre class="programlisting">{
   "total_rows" : 2666,
   "rows" : [
      {
         "value" : {
            "rev" : "1-a3544d296de19e6f5b932ea77d886942"
         },
         "id" : "Zingylemontart",
         "key" : "Zingylemontart"
      },
      {
         "value" : {
            "rev" : "1-91635098bfe7d40197a1b98d7ee085fc"
         },
         "id" : "Yogurtraita",
         "key" : "Yogurtraita"
      }
   ],
   "offset" : 0
}</pre></div></div><div class="section" title="5.14.&nbsp;POST /db/_missing_revs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-missing-revs_post"></a>5.14.&nbsp;<code class="literal">POST /db/_missing_revs</code></h2></div></div></div><div class="informaltable"><table summary="URL API POST /db/_missing_revs" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_missing_revs</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 JSON list of document revisions
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON of missing revisions
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr></tbody></table></div></div><div class="section" title="5.15.&nbsp;POST /db/_revs_diff"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-revs-diff_post"></a>5.15.&nbsp;<code class="literal">POST /db/_revs_diff</code></h2></div></div></div><div class="informaltable"><table summary="URL API POST /db/_revs_diff" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">POST /db/_revs_diff</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 JSON list of document and revisions
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON list of differences from supplied document/revision list
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr></tbody></table></div></div><div class="section" title="5.16.&nbsp;GET /db/_security"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-security_get"></a>5.16.&nbsp;<code class="literal">GET /db/_security</code></h2></div></div></div><div class="informaltable"><table summary="URL API GET /db/_security" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">GET /db/_security</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON of the security object
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr></tbody></table></div><p>
      Gets the current secrity object from the specified database. The
      security object consists of two compulsory elements,
      <code class="literal">admins</code> and <code class="literal">readers</code>, which
      are used to specify the list of users and/or roles that have admin
      and reader rights to the database respectively. Any additional
      fields in the security object are optional. The entire security
      object is made available to validation and other internal
      functions so that the database can control and limit
      functionality.
    </p><p>
      To get the existing security object you would send the following
      request:
    </p><pre class="programlisting">{
   "admins" : {
      "roles" : [],
      "names" : [
         "mc",
         "slp"
      ]
   },
   "readers" : {
      "roles" : [],
      "names" : [
         "tim",
         "brian"
      ]
   }
}</pre><div class="table"><a name="table-couchdb-api-db-json-security"></a><p class="title"><b>Table&nbsp;5.8.&nbsp;
 Security Object
 </b></p><div class="table-contents"><table summary="
 Security Object
 " border="1"><colgroup><col class="item" width="30%"><col class="desc" width="70%"></colgroup><tbody><tr><td><span class="bold"><strong>Field</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><code class="literal">admins</code>  </td><td>
 Roles/Users with admin privileges
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">roles</code> <code class="literal">[array]</code> </td><td>
 List of roles with parent privilege
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">users</code> <code class="literal">[array]</code> </td><td>
 List of users with parent privilege
 </td></tr><tr><td><code class="literal">readers</code>  </td><td>
 Roles/Users with reader privileges
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">roles</code> <code class="literal">[array]</code> </td><td>
 List of roles with parent privilege
 </td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="literal">users</code> <code class="literal">[array]</code> </td><td>
 List of users with parent privilege
 </td></tr></tbody></table></div></div><br class="table-break"><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        If the security object for a database has never beent set, then
        the value returned will be empty.
      </p></div></div><div class="section" title="5.17.&nbsp;PUT /db/_security"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-security_put"></a>5.17.&nbsp;<code class="literal">PUT /db/_security</code></h2></div></div></div><div class="informaltable"><table summary="URL API PUT /db/_security" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">PUT /db/_security</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 JSON specifying the admin and user security for the database
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 JSON status message
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr></tbody></table></div><p>
      Sets the security object for the given database.For example, to
      set the security object for the <code class="literal">recipes</code>
      database:
    </p><pre class="programlisting">PUT http://couchdb:5984/recipes/_security
Content-Type: application/json

{
   "admins" : {
      "roles" : [],
      "names" : [
         "mc",
         "slp"
      ]
   },
   "readers" : {
      "roles" : [],
      "names" : [
         "tim",
         "brian"
      ]
   }
}</pre><p>
      If the setting was successful, a JSON status object will be
      returned:
    </p><pre class="programlisting">{
   "ok" : true
}</pre></div><div class="section" title="5.18.&nbsp;GET /db/_revs_limit"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-revs-limit_get"></a>5.18.&nbsp;<code class="literal">GET /db/_revs_limit</code></h2></div></div></div><div class="informaltable"><table summary="URL API GET /db/_revs_limit" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">GET /db/_revs_limit</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 None
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 The current revision limit setting
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr></tbody></table></div><p>
      Gets the current <code class="literal">revs_limit</code> (revision limit)
      setting.
    </p><p>
      For example to get the current limit:
    </p><pre class="programlisting">GET http://couchdb:5984/recipes/_revs_limit
Content-Type: application/json</pre><p>
      The returned information is the current setting as a numerical
      scalar:
    </p><pre class="programlisting">1000</pre></div><div class="section" title="5.19.&nbsp;PUT /db/_revs_limit"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="couchdb-api-db_db-revs-limit_put"></a>5.19.&nbsp;<code class="literal">PUT /db/_revs_limit</code></h2></div></div></div><div class="informaltable"><table summary="URL API PUT /db/_revs_limit" border="1"><colgroup><col class="field" width="33%"><col class="info" width="33%"><col class="addinfo" width="34%"></colgroup><tbody><tr><td><span class="bold"><strong>Method</strong></span></td><td colspan="2"><code class="literal">PUT /db/_revs_limit</code></td></tr><tr><td><span class="bold"><strong>Request</strong></span></td><td colspan="2">
 A scalar integer of the revision limit setting
 </td></tr><tr><td><span class="bold"><strong>Response</strong></span></td><td colspan="2">
 Confirmation of setting of the revision limit
 </td></tr><tr><td><span class="bold"><strong>Admin Privileges Required</strong></span></td><td colspan="2">no</td></tr></tbody></table></div><p>
      Sets the maximum number of document revisions that will be tracked
      by CouchDB, even after compaction has occurred. You can set the
      revision limit on a database by using <code class="literal">PUT</code> with
      a scalar integer of the limit that you want to set as the request
      body.
    </p><p>
      For example to set the revs limit to 100 for the
      <code class="literal">recipes</code> database:
    </p><pre class="programlisting">PUT http://couchdb:5984/recipes/_revs_limit
Content-Type: application/json

100</pre><p>
      If the setting was successful, a JSON status object will be
      returned:
    </p><pre class="programlisting">{
   "ok" : true
}</pre></div></div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="couchdb-api-basics.html">Prev</a>&nbsp;</td><td align="center" width="20%">&nbsp;</td><td align="right" width="40%">&nbsp;<a accesskey="n" href="couchdb-api-dbdoc.html">Next</a></td></tr><tr><td valign="top" align="left" width="40%">Chapter&nbsp;4.&nbsp;CouchDB API&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td valign="top" align="right" width="40%">&nbsp;Chapter&nbsp;6.&nbsp;CouchDB API Server Document Methods</td></tr></table></div></body></html>